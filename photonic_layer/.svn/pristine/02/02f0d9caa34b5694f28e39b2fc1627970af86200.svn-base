package PhotonicElements.InputSources.LaserEfficiency;

import flanagan.interpolation.LinearInterpolation;

public class DynamicEfficiency extends AbstractLaserEfficiency {

	// This class is based on the numbers from Freedom Photonics High power Lasers
	
	// 20 oC
	double[] OpticalPowermW_20C = {0, 0, 0, 0, 6.359300477, 44.51510334, 63.59300477, 89.03020668, 111.2877583, 136.7249603, 162.1621622, 187.5993641, 213.036566, 232.1144674, 260.7313196, 279.809221, 295.7074722, 324.3243243, 352.9411765, 381.5580286, 416.5341812, 445.1510334, 461.0492846, 489.6661367, 515.1033386, 534.1812401, 556.4387917, 569.1573927, 581.8759936, 594.5945946, 610.4928458, 623.2114467, 635.9300477, 651.8282989, 670.9062003, 689.9841017, 709.0620032, 728.1399046, 750.3974563, 772.6550079, 798.0922099, 817.1701113, 836.2480127, 861.6852146, 883.9427663, 906.200318, 925.2782194, 934.8171701, 963.4340223, 982.5119237, 1004.769475, 1030.206677, 1055.643879, 1077.901431, 1093.799682, 1109.697933, 1128.775835, 1144.674086, 1160.572337, 1179.650238, 1195.54849, 1220.985692, 1230.524642, 1249.602544, 1268.680445, 1287.758347, 1303.656598, 1322.734499, 1338.63275, 1354.531002, 1373.608903, 1395.866455, 1421.303657, 1440.381558, 1465.81876, 1484.896661, 1516.693164, 1538.950715, 1561.208267, 1586.645469, 1608.903021, 1631.160572, 1656.597774, 1672.496025, 1691.573927, 1717.011129, 1729.72973, 1748.807631, 1767.885533, 1783.783784, 1806.041335, 1818.759936} ;
	double[] currentmA_OP_20C = {0, 254.6810333, 308.3003363, 368.6220521, 435.6248695, 542.7356074, 576.1837378, 643.1226211, 696.6673344, 730.0941535, 776.9257982, 817.0550301, 870.5890877, 904.0372181, 944.1557943, 991.0087504, 1017.765124, 1064.586113, 1091.299863, 1138.120852, 1211.730182, 1245.146345, 1278.605131, 1312.021294, 1352.150526, 1392.301069, 1419.036131, 1445.80316, 1479.272602, 1519.444456, 1546.200829, 1579.670271, 1599.734887, 1646.598499, 1680.046629, 1700.089934, 1746.94289, 1780.39102, 1827.233321, 1867.373208, 1907.50244, 1940.950571, 2001.208352, 2061.444823, 2108.287123, 2141.724598, 2188.577554, 2222.057651, 2268.878641, 2302.326771, 2335.764246, 2396.000716, 2436.129948, 2476.269836, 2509.728622, 2556.592233, 2596.742777, 2630.201563, 2670.362761, 2717.215718, 2770.781742, 2810.910974, 2851.093484, 2877.839202, 2917.989745, 2944.735462, 2984.896661, 3025.047205, 3071.910816, 3105.369602, 3138.817733, 3178.95762, 3205.682026, 3245.83257, 3272.556976, 3326.112345, 3359.517853, 3386.252914, 3412.987976, 3453.117208, 3486.554683, 3519.992157, 3546.716564, 3600.282588, 3640.433131, 3660.455125, 3700.626979, 3727.372697, 3747.416001, 3787.5772, 3821.014675, 4000} ;
	
	double[] WPE_20C = {0, 0.002861848603, 0.009226244363, 0.01558878839, 0.02548535899, 0.03326077295, 0.03962053939, 0.04809961073, 0.05657960793, 0.06293937436, 0.07000557576, 0.077779138, 0.08272510863, 0.08979038417, 0.09685658557, 0.103922787, 0.1095751926, 0.116641394, 0.1208827814, 0.125828752, 0.1307756485, 0.1371344891, 0.1449061996, 0.1498530961, 0.1576248066, 0.1639854989, 0.1703452653, 0.1767050318, 0.1830638723, 0.1887162779, 0.1950751185, 0.2014339591, 0.2099130304, 0.2162727969, 0.2233389983, 0.2318189955, 0.2410045018, 0.24595325, 0.2530185255, 0.2600856528, 0.2692748626, 0.2770484248, 0.2862367087, 0.2925992527, 0.3046114248, 0.3123868387, 0.3194548919, 0.3272312317, 0.3350038681, 0.3427783562, 0.3505537701, 0.3590365449, 0.3653981631, 0.3724699197, 0.3802471854, 0.3866088035, 0.3950925042, 0.4021624091, 0.4064093516, 0.4085388411, 0.4085480997, 0.4085610618, 0.4085675429, 0.4078685148, 0.4057603203, 0.4036502741, 0.4015365243, 0.3994246264, 0.3973108767, 0.3959063395, 0.3952082373, 0.3938018484, 0.3923982372, 0.3902891168, 0.3888864313, 0.3874855977, 0.3867865696, 0.3839737918, 0.3825720323, 0.3797574028, 0.3790593006, 0.3783593467, 0.3776593928, 0.3762576332, 0.3755595311, 0.3748632806, 0.3748734651, 0.3741753629, 0.3741873992, 0.3734920746, 0.3727958241, 0.372104203, 0.3707015176, 0.3700043413, 0.3693080908} ;
	double[] currentmA_WPE_20C = {0, 248.9753761, 294.7542549, 327.4270007, 373.1544425, 405.8066136, 418.82016, 431.8028443, 451.338595, 464.3521414, 477.3554005, 496.9014386, 503.3824933, 509.8326859, 522.835945, 535.839204, 542.3099714, 555.3132304, 574.9107055, 581.3917602, 594.4258814, 600.8863614, 607.3262666, 620.3603878, 626.800293, 646.3669059, 659.3804523, 672.3939987, 678.8544787, 685.3252461, 691.785726, 698.246206, 711.2288903, 724.2424367, 737.2456958, 756.7814465, 769.7538434, 795.8940975, 802.3442901, 821.9006156, 861.0852783, 880.6313165, 913.2629127, 945.9356586, 965.4199723, 998.0721434, 1024.181535, 1063.386773, 1076.379745, 1102.478849, 1135.13102, 1174.32597, 1200.44565, 1252.767308, 1298.525611, 1324.645291, 1370.393307, 1409.608832, 1468.524706, 1540.577575, 1606.10824, 1697.85117, 1743.722636, 1796.157455, 1874.825114, 1940.386641, 1979.735902, 2032.191296, 2071.540557, 2130.53873, 2189.526616, 2235.418656, 2300.969895, 2373.084488, 2445.188794, 2530.399233, 2582.834052, 2674.618132, 2753.275504, 2831.953452, 2890.941337, 2936.82309, 2982.704842, 3061.362215, 3120.3501, 3192.444119, 3264.52785, 3323.515736, 3408.7056, 3487.352685, 3559.446703, 3664.306054, 3736.41036, 3801.951312, 4000} ;
	
	// 50 oC
	double[] OpticalPowermW_50C = {0, 0, 0, 0, 0, 0, 0, 0, 0, 3.179650238, 15.89825119, 31.79650238, 54.05405405, 73.13195548, 89.03020668, 108.1081081, 127.1860095, 149.4435612, 174.8807631, 197.1383148, 222.5755167, 238.4737679, 260.7313196, 282.9888712, 302.0667727, 330.6836248, 356.1208267, 378.3783784, 406.9952305, 435.6120827, 464.2289348, 483.3068362, 515.1033386, 534.1812401, 562.7980922, 581.8759936, 604.1335453, 626.391097, 651.8282989, 670.9062003, 693.163752, 721.7806041, 747.217806, 769.4753577, 794.9125596, 817.1701113, 839.427663, 864.8648649, 883.9427663, 903.0206677, 925.2782194, 944.3561208, 963.4340223, 988.8712242, 1004.769475, 1027.027027, 1042.925278, 1062.00318, 1074.721781, 1090.620032, 1109.697933, 1125.596184, 1141.494436, 1163.751987, 1179.650238, 1192.368839, 1208.267091, 1227.344992, 1243.243243, 1265.500795, 1281.399046, 1294.117647, 1306.836248} ;
	double[] currentmA_OP_50C = {0, 268.1071704, 308.3216476, 361.9409506, 415.5602535, 462.4771436, 542.906098, 623.3350524, 683.6567683, 737.2441042, 804.2256102, 844.3868091, 897.9315224, 944.7844785, 984.9456774, 1018.393808, 1078.65159, 1118.791477, 1165.623122, 1219.167835, 1272.701893, 1319.565505, 1366.407805, 1413.250105, 1453.400649, 1493.519225, 1540.35087, 1587.19317, 1634.014159, 1674.132735, 1727.656137, 1781.211506, 1834.724253, 1874.874796, 1935.100611, 1988.65598, 2035.49828, 2102.447819, 2155.981877, 2202.834833, 2256.379546, 2316.605361, 2363.437006, 2403.576893, 2463.813364, 2510.655664, 2564.200378, 2617.734435, 2664.587391, 2711.440347, 2764.985061, 2825.242843, 2878.798212, 2939.034682, 2999.30312, 3066.252659, 3119.818683, 3166.671639, 3213.545907, 3267.111931, 3334.072126, 3394.340564, 3447.906588, 3508.153714, 3534.910088, 3588.486768, 3628.647967, 3668.79851, 3708.959709, 3769.206835, 3809.368034, 3836.135063, 4000} ;
	
	double[] WPE_50C = {0.00002962767884, 0.0007443954308, 0.001459163183, 0.002172079205, 0.004302494486, 0.00572462307, 0.007849483162, 0.01209827748, 0.01634336834, 0.0241215599, 0.03119239062, 0.03826136962, 0.04462298779, 0.05169104092, 0.05946552902, 0.06794645209, 0.07713381012, 0.08490922408, 0.09268278632, 0.09975176532, 0.1089381975, 0.1181246297, 0.1251926828, 0.1322625876, 0.137916845, 0.1456922589, 0.1527603121, 0.1598283652, 0.169017575, 0.1760874798, 0.1817417372, 0.1881042812, 0.1944658994, 0.2008275175, 0.2057771916, 0.2142590406, 0.2213289454, 0.2269869062, 0.2333503761, 0.2382991243, 0.2446625942, 0.2517324991, 0.2559766641, 0.2623382823, 0.2665852248, 0.2722431856, 0.2750754066, 0.2779104051, 0.2800398945, 0.282168458, 0.2828860034, 0.2836044746, 0.2850266032, 0.2864487318, 0.2871653513, 0.2892948407, 0.2907151175, 0.2907262279, 0.2907382641, 0.2907465969, 0.2900484947, 0.2893513184, 0.2872412722, 0.2858376609, 0.2830211797, 0.2816175684, 0.2788029389, 0.2766910409, 0.2752902072, 0.2738856701, 0.2717774756, 0.2710793734, 0.268263818, 0.2675657158, 0.2661630304, 0.26546678} ;
	double[] currentmA_WPE_50C = {0, 262.1123712, 321.079682, 366.9408599, 445.5467953, 511.0568851, 550.3444218, 622.3664285, 668.1761695, 720.4875399, 766.2561313, 798.9185897, 825.0382691, 851.1476611, 877.2467656, 903.3355828, 929.4141127, 962.0662837, 981.6123218, 1014.27478, 1033.800244, 1053.325707, 1079.435099, 1118.650624, 1138.227524, 1170.879695, 1196.989087, 1223.098479, 1262.283142, 1301.498667, 1321.075567, 1353.748313, 1379.867992, 1405.987672, 1438.680992, 1471.322876, 1510.538401, 1556.327567, 1595.553379, 1621.693633, 1660.919446, 1700.134971, 1739.391645, 1765.511324, 1824.427198, 1870.216364, 1916.04668, 1981.536195, 2053.589064, 2119.088867, 2197.715377, 2282.894953, 2348.405043, 2413.915133, 2485.988577, 2558.041446, 2610.445403, 2689.0822, 2774.272064, 2833.249663, 2892.237548, 2957.7785, 3023.340027, 3088.891266, 3154.463081, 3220.01432, 3298.692267, 3351.147661, 3436.3581, 3495.356273, 3574.023933, 3633.011818, 3705.136699, 3764.124584, 3836.22889, 4000} ;
	
	// 70 oC
	double[] OpticalPowermW_70C = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3.179650238, 12.71860095, 22.25755167, 34.97615262, 47.69475358, 66.77265501, 82.6709062, 101.7488076, 120.8267091, 139.9046105, 155.8028617, 174.8807631, 197.1383148, 219.3958665, 241.6534181, 257.5516693, 279.809221, 298.8871224, 317.9650238, 337.0429253, 352.9411765, 378.3783784, 400.63593, 422.8934817, 445.1510334, 467.4085851, 483.3068362, 499.2050874, 515.1033386, 540.5405405, 556.4387917, 581.8759936, 600.9538951, 623.2114467, 639.1096979, 658.1875994, 680.445151, 699.5230525, 718.6009539, 737.6788553, 753.5771065, 769.4753577, 785.3736089, 804.4515103, 826.709062, 845.7869634, 858.5055644, 874.4038156, 890.3020668, 903.0206677, 915.7392687, 928.4578696, 937.9968203, 950.7154213, 963.4340223, 982.5119237, 1004.769475} ;
	double[] currentmA_OP_70C = {0, 281.5226518, 328.4501976, 395.4636706, 449.0723179, 509.4046893, 563.0239923, 630.048121, 697.0722497, 743.9891397, 811.0132684, 878.0373971, 938.3484573, 991.9571046, 1065.662335, 1119.249671, 1179.53942, 1219.711274, 1273.287954, 1326.843323, 1387.111761, 1433.964717, 1487.520086, 1534.373042, 1567.831828, 1634.792023, 1681.634323, 1728.476624, 1782.021337, 1828.884949, 1875.727249, 1915.877792, 1976.135574, 2036.393356, 2089.959381, 2143.493438, 2197.038152, 2250.582865, 2304.127578, 2357.672291, 2404.535903, 2451.399515, 2498.263127, 2551.797184, 2605.363209, 2652.194854, 2699.04781, 2739.187697, 2792.753722, 2839.606678, 2886.448979, 2933.301935, 2986.857304, 3027.007847, 3087.276284, 3134.139896, 3187.705921, 3227.856464, 3274.698764, 3328.254133, 3381.830814, 3421.992013, 3488.962863, 3529.134717, 3562.604159, 3616.180839, 3663.065762, 3709.94003, 3756.814297, 3796.964841, 4000} ;
	
	double[] WPE_70C = {0, 0.0000407380584, 0.00004814497811, 0.00005740362774, 0.0007740231096, 0.00007592092702, 0.00008980890147, 0.000100919281, 0.0008166128979, 0.001532306515, 0.002954435099, 0.005789433618, 0.008622580406, 0.01286859713, 0.01711461385, 0.02206521381, 0.02772317461, 0.0340866445, 0.04044826267, 0.04681173256, 0.05388071156, 0.06306992132, 0.07013982618, 0.07650144435, 0.08215570168, 0.08781088488, 0.09488171561, 0.1012461114, 0.108317868, 0.1139730512, 0.1224549001, 0.1295285084, 0.1351864692, 0.141550865, 0.1472088258, 0.1542796565, 0.160645904, 0.1663047906, 0.1712600199, 0.1748014534, 0.1790530253, 0.1818917273, 0.1854340866, 0.1896819551, 0.1953436194, 0.1995896361, 0.2038402821, 0.2045569016, 0.2045717154, 0.2045846776, 0.206007732, 0.2060234717, 0.2060373597, 0.2067567568, 0.2060632839, 0.2053688852, 0.2032606907, 0.201153422, 0.2011682358, 0.2011765686} ;
	double[] currentmA_WPE_70C = {0, 281.781858, 334.2063897, 399.7370544, 471.8104981, 530.7983836, 629.0943806, 707.7311782, 773.2515555, 838.7719327, 904.2820226, 969.7715377, 1022.15492, 1074.517727, 1126.880535, 1166.126922, 1211.916088, 1251.1419, 1277.261579, 1316.487392, 1349.14985, 1388.334513, 1427.550038, 1453.669717, 1473.246618, 1499.376584, 1545.145176, 1590.924054, 1643.245712, 1669.375679, 1702.017563, 1767.445353, 1813.23452, 1859.013398, 1904.802564, 1950.571156, 2009.456167, 2061.7984, 2133.810119, 2199.289347, 2290.970553, 2382.672334, 2454.704629, 2520.173569, 2592.175001, 2644.537808, 2729.665948, 2801.739392, 2906.588455, 2998.331386, 3070.394542, 3181.796672, 3280.092669, 3371.825312, 3463.57853, 3548.778681, 3627.446341, 3712.667067, 3817.516131, 4000} ;
	
	@Override
	public double getEfficiencyFromCurrent(double currentmA, double tempCelsius) {
		LinearInterpolation linEff_20C = new LinearInterpolation(currentmA_WPE_20C, WPE_20C) ;
		LinearInterpolation linEff_50C = new LinearInterpolation(currentmA_WPE_50C, WPE_50C) ;
		LinearInterpolation linEff_70C = new LinearInterpolation(currentmA_WPE_70C, WPE_70C) ;
		double eff_20C = linEff_20C.interpolate(currentmA) ;
		double eff_50C = linEff_50C.interpolate(currentmA) ;
		double eff_70C = linEff_70C.interpolate(currentmA) ;
		double[] eff_temp = {eff_20C, eff_50C, eff_70C} ;
		double[] temperature = {20, 50, 70} ;
		LinearInterpolation linEff_temperature = new LinearInterpolation(temperature, eff_temp) ;
		return linEff_temperature.interpolate(tempCelsius) ;
	}

	@Override
	public double getOpticalPowermWfromCurrent(double currentmA, double tempCelsius) {
		LinearInterpolation linPow_20C = new LinearInterpolation(currentmA_OP_20C, OpticalPowermW_20C) ;
		LinearInterpolation linPow_50C = new LinearInterpolation(currentmA_OP_50C, OpticalPowermW_50C) ;
		LinearInterpolation linPow_70C = new LinearInterpolation(currentmA_OP_70C, OpticalPowermW_70C) ;
		double Pow_20C = linPow_20C.interpolate(currentmA) ;
		double Pow_50C = linPow_50C.interpolate(currentmA) ;
		double Pow_70C = linPow_70C.interpolate(currentmA) ;
		double[] Pow_temp = {Pow_20C, Pow_50C, Pow_70C} ;
		double[] temperature = {20, 50, 70} ;
		LinearInterpolation linPow_temperature = new LinearInterpolation(temperature, Pow_temp) ;
		return linPow_temperature.interpolate(tempCelsius) ;
	}

	@Override
	public double getEFficiencyFromOpticalPowermW(double powermW, double tempCelsius) {
		double ImA = getCurrentmAfromOpticalPowermW(powermW, tempCelsius) ;
		double WPE = getEfficiencyFromCurrent(ImA, tempCelsius) ;
		return WPE;
	}

	@Override
	public double getEfficiencyFromOpticalPowerdBm(double powerdBm, double tempCelsius) {
		double powermW = Math.pow(10, powerdBm/10) ;
		double WPE = getEFficiencyFromOpticalPowermW(powermW, tempCelsius) ;
		return WPE ;
	}
	
	@Override
	public double getCurrentmAfromOpticalPowermW(double powermW, double temCelsius){
		// find current from optical power, then find the efficiency based on current
		LinearInterpolation linCurrent_20C = new LinearInterpolation(OpticalPowermW_20C, currentmA_OP_20C) ;
		LinearInterpolation linCurrent_50C = new LinearInterpolation(OpticalPowermW_50C, currentmA_OP_50C) ;
		LinearInterpolation linCurrent_70C = new LinearInterpolation(OpticalPowermW_70C, currentmA_OP_70C) ;
		double ImA_20C = linCurrent_20C.interpolate(powermW) ;
		double ImA_50C = linCurrent_50C.interpolate(powermW) ;
		double ImA_70C = linCurrent_70C.interpolate(powermW) ;
		double[] ImA_temp = {ImA_20C, ImA_50C, ImA_70C} ;
		double[] temperature = {20, 50, 70} ;
		LinearInterpolation linImA_temperature = new LinearInterpolation(temperature, ImA_temp) ;
		return linImA_temperature.interpolate(temCelsius) ;
	}

}
